<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Nest Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/admin/imgs/theme/favicon.svg"
    />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-green: #3BB77E;
            --light-green: #DEF9EC;
            --text-gray: #7E7E7E;
        }

        .btn-primary {
            background-color: var(--primary-green);
            border-color: var(--primary-green);
        }

        .btn-primary:hover {
            background-color: #2a9d64;
            border-color: #2a9d64;
        }

        .modal-header {
            background-color: var(--primary-green);
            color: white;
        }

        .form-control:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 0.25rem rgba(59, 183, 126, 0.25);
        }
    </style>
    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f5f5f5;
          color: #333;
      }

      .container {
          max-width: 1000px;
          margin: 2rem auto;
          padding: 0 1rem;
      }

      .category-card {
          background: white;
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
          padding: 2rem;
      }

      .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
      }

      .card-title {
          font-size: 1.5rem;
          color: #2c3e50;
      }

      /* Add Category Form */
      .add-category-form {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          margin-bottom: 2rem;
          padding: 1rem;
          background: #f8f9fa;
          border-radius: 8px;
      }

      .form-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
      }
      .file-input{
        flex: 1;
          padding: 0.5rem;
          border: 1px solid #e9ecef;
          border-radius: 6px;
          font-size: 0.9rem;
      }

      .form-input:focus {
          outline: none;
          border-color: #40c057;
          box-shadow: 0 0 0 2px rgba(64, 192, 87, 0.2);
      }

      .btn-add {
          background: #40c057;
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }

      /* Category List */
      .category-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
      }

      .category-item {
          border: 1px solid #e9ecef;
          border-radius: 8px;
          overflow: hidden;
      }

      .category-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 1.5rem;
          background: #f8f9fa;
          cursor: pointer;
      }

      .category-name {
          display: flex;
          align-items: center;
          gap: 1rem;
      }

      .category-image {
          width: 40px;
          height: 40px;
          border-radius: 6px;
          object-fit: cover;
      }

      .category-actions {
          display: flex;
          gap: 0.5rem;
      }

      .btn {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          border: none;
          cursor: pointer;
          font-size: 0.875rem;
          transition: all 0.2s;
      }

      .btn-edit {
          background: #339af0;
          color: white;
      }

      .btn-list {
          background: #40c057;
          color: white;
      }

      .btn-unlist {
          background: #fa5252;
          color: white;
      }

      .btn:hover {
          opacity: 0.9;
      }

      /* Subcategory styles */
      .subcategory-list {
          padding: 1rem 1.5rem 1rem 3.5rem;
          background: white;
          border-top: 1px solid #e9ecef;
      }

      .subcategory-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 0;
          border-bottom: 1px solid #f1f3f5;
      }

      .subcategory-item:last-child {
          border-bottom: none;
      }

      .subcategory-name {
          display: flex;
          align-items: center;
          gap: 1rem;
      }

      .subcategory-image {
          width: 30px;
          height: 30px;
          border-radius: 4px;
          object-fit: cover;
      }

      /* Dropdown arrow */
      .arrow {
          transition: transform 0.3s ease;
      }

      .arrow.active {
          transform: rotate(180deg);
      }

      /* Add Subcategory button */
      .btn-add-sub {
          background: none;
          border: 1px dashed #40c057;
          color: #40c057;
          padding: 0.5rem 1rem;
          border-radius: 6px;
          cursor: pointer;
          font-size: 0.875rem;
          margin-top: 0.5rem;
          width: 100%;
      }

      .btn-add-sub:hover {
          background: #f1f9f1;
      }
      
      /* dfghjkl; */
      /* Basic styling for the Add Subcategory button */
.add-subcategory-btn {
  background-color: transparent;
  color: #40c057;
  border: 1px dotted #40c057;
  padding: 10px;
  cursor: pointer;
}

/* Modal Background */
.modal {
  display: none; /* Hidden by default */
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4); /* Black background with opacity */
}

/* Modal Content Box */
.modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 400px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
}

/* Form Styles */
#subcategoryForm {
  display: flex;
  flex-direction: column;
}

#subcategoryForm label {
  margin-bottom: 5px;
}

#subcategoryForm input {
  padding: 8px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.add-btn {
  background-color: green;
  color: white;
  padding: 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5); /* Black background with opacity */
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 50%;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
/* Modal Background */
.modal-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

/* Centered Modal Form */
.edit-category-form {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    width: 400px;
    max-width: 90%;
}
.modal {
  display: none; 
  position: fixed; 
  z-index: 1; 
  left: 0;
  top: 0;
  width: 80%; 
  height: 80%; 
  overflow: auto; 
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
  margin: 15% auto; 
  padding: 20px;
  border: 1px solid #888;
  width: 30%;
  max-width: 200px;
  background-color: white;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
/* modal for edit category */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 100%;
  max-width: 600px;
  background-color: white;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

  </style>
  <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap JS and Popper.js (for modal functionality) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

<!-- jQuery (for optional jQuery-based modal hide) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <link rel="stylesheet" href="/toast.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Template CSS -->
    <link href="/admin/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
  </head>
 
  <body>

    <div class="toast-container" id="toastContainer"></div>
    <div class="screen-overlay"></div>
    <%-include('../partials/sidebar.ejs') %>
  
    <main class="main-wrap">
    <%-include('../partials/adminHeader')%>
      <section class="content-main">
        <div class="content-header">
          <div>
            <h2 class="content-title card-title">Categories</h2>
            <p>Add, edit or delete a category</p>
          </div>
          <div>
            <input
              type="text"
              placeholder="Search Categories"
              class="form-control bg-white"
            />
          </div>
        </div>
        <div class="container">
          <div class="category-card">
              <div class="card-header">
                  <h1 class="card-title">Category Management</h1>
              </div>
  
              <!-- Add Category Form -->
              <form class="add-category-form" id="form-category" enctype="multipart/form-data">

                  <input type="text" class="form-input" name="title" id="title" placeholder="New Category Name">
                  <input type="text"  class="form-input" name="discription" id="discr" placeholder="description">
                  <!-- <input type="number"  class="form-input" name="Offer" id="Offer" placeholder="Category Offer"> -->
                  <input type="file" class="file-input" name="category-image" id="image" accept="image/*">
                 <!-- Image Preview Modal -->

                  <button type="submit" class="btn-add">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                      Add Category
                  </button>
              </form>
              <!-- Image Preview Modal -->
<div id="imageModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>
    <img id="modalImage" src="" alt="Preview" style="max-width: 30%; height:30%;">
  </div>
</div>

              <!-- EDIT CATEGRY -->
              <!-- Modal Container -->
              <div id="editModal" class="modal" style="display: none; flex-direction: column; gap: 15px;">
                <!-- edit-form  -->
                <form action="" id="edit-category">
                  <div class="modal-content">
                    <span id="closeUpdateModal" class="close">&times;</span>
                    <h3>Update Information</h3>
              
                    <!-- Title and Description Inputs -->
                    <div style="display: flex; gap: 10px;">
                      <div>
                        <label for="modalTitle">Title:</label>
                        <input type="text" id="modalTitle" name="title" placeholder="Enter title" >
                      </div>
                      <span>
                        <label for="modalDescription">Description:</label>
                        <input type="text" id="modalDescription" name="description" placeholder="Enter description" >
                      </span>
                          
                     
                    </div>
                    <div>
                      <label for="modalImageInput">Image:</label>
                      <input type="file" id="modalImageInput" name="image" accept="image/*">
                    </div>
                    

                    <!-- Image Input -->
                    
              
                    <!-- Update Button -->
                    <button type="submit" id="updateButton">Update</button>
                  </div>
                </form>
              </div>

              <!-- onclick="toggleSubcategories(this) -->
              <!-- Category List -->
              <div class="category-list">
                <% data.forEach((item, index) => { %>
                  <div class="category-item" id="divTAbl<%= item._id %>">
                    <div class="category-header">
                      <div class="category-name">
                        <img src="http://localhost:4000/images/<%= item.image %>" style="width: 60px;height: 60px;" alt="Category Image" class="category-image">
                        <span><%= item.category %></span>
                      </div>
                      <p><%= item.description %></p>
                      <div style="display: flex; gap: 8px; align-items: center;">
                        
                          
                          <% if (item.Offer) { %>
                            <h5 style="color: green;"><%= item.Offer.offer%> % OFF</h5>
                             <% } %>
                       
                      </div>
              
                      <div class="category-actions" style="display: flex; gap: 10px; align-items: center;">
                        <!-- Add Offer button - Opens specific modal -->
                       
    <!-- modal for add offer -->
                         
                        <!-- Edit Button -->
                        <button class="btn btn-edit edit-btn" data-id="<%= item.id %>">Edit</button>
              
                        <!-- List/Unlist Button -->
                        <% if (item.isList === true) { %>
                          <button 
                            class="btn btn-outline-danger" 
                            onclick="toggleItemStatus('<%= item.id %>', false, '<%= index %>')"
                          >
                            UnList
                          </button>
                        <% } else { %>
                          <button 
                            class="btn btn-outline-success" 
                            onclick="toggleItemStatus('<%= item.id %>', true, '<%= index %>')"
                          >
                            List
                          </button>
                        <% } %>
                      </div>
                    </div>
                  </div>
                <% }) %>
              </div>
              
              
              </div>
          </div>
      </div>
    <!-- HTML Form Structure -->
    

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- Modal Background Wrapper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>

   
    

</script>



<script>
// Add Offer




// REMOVE OFFER0000000000000000000

//END REMOVE OFFER0000000000000000000



document.getElementById('image').addEventListener('change', function (event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      
      const modalImage = document.getElementById('modalImage');
      modalImage.src = e.target.result;
      
     
      document.getElementById('imageModal').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
});


document.getElementById('closeModal').addEventListener('click', function () {
  document.getElementById('imageModal').style.display = 'none';
});

// Preview Image**********************


// List and Unlist $$$$$$$$$$$$$$$$$$$$$$$$$$

          function toggleItemStatus(itemId,condition){
            console.log("working")
            console.log(itemId,condition);
            fetch("/admin/categoryStatus",{
                method:"PATCH",
                headers:{
                    "Content-Type":"application/json; charset=UTF-8"
                },
                body:JSON.stringify({itemId,condition})
            })
            .then(res=> res.json())
            .then(data=>{
              if(data.success){
              
                showToast(data.message, 'success');
                alert(data.message)
                updateHtml(data.response)
            }else{
              alert(data.message)
              showToast(data.message, 'error');
            }
                
                
                
            })
            
          }
// end List and Unlist $$$$$$$$$$$$$$$$$$$$$$$$$$



// EDIT CATEGORY [][[[[[]]]]]

document.addEventListener("DOMContentLoaded", function() {


  const editButtons = document.querySelectorAll(".edit-btn");
  const modal = document.getElementById("editModal");
  const closeUpdateModal = document.getElementById("closeUpdateModal");
  const updateButton = document.getElementById("updateButton");

  // Check if edit buttons are being selected
  console.log("Edit buttons:", editButtons);

  // Open modal for clicked item
  editButtons.forEach((button) => {
    button.addEventListener("click", function() {
      const productId = this.getAttribute("data-id");
      console.log("Edit button clicked for product ID:", productId);

     
    
      
      modal.style.display = "flex";
      console.log("Modal should now be visible.");

      document.getElementById('edit-category').addEventListener('submit', (e) => {
    e.preventDefault(); // Prevent default form submission
    
    const modalTitle = document.getElementById("modalTitle").value.trim();
    const modalDescription = document.getElementById("modalDescription").value.trim();
    
    
    const imageFile = document.getElementById('modalImageInput').files[0];

    // Only show an alert if the title or description fields are non-empty and contain invalid characters
    if ((modalTitle && !modalTitle.match(/^[A-Za-z ]+$/)) || 
        (modalDescription && !modalDescription.match(/^[A-Za-z ]+$/))) {
        alert("Title and Description should contain only letters and spaces.");
        return; // Stop execution if validation fails
    }
    const formData = new FormData();

    if (modalTitle) {
        formData.append('modalTitle', modalTitle);
    }
    if (modalDescription) {
        formData.append('modalDescription', modalDescription);
    }
    
    if (imageFile) {
        formData.append('image', imageFile);
    }
formData.append('productId', productId);
console.log('nbnm');

fetch('/admin/EditCategory', {
  method: "PATCH",
  body: formData,
})
  .then(res => res.json())
  .then(data => {
    console.log(data)
    if(data.success){
      showToast(data.message, 'success');
      alert(data.message)
                updateHtml(data.response)
            }else{
              showToast(data.message, 'error');
              alert(data.message)
            }
  })
  .catch(error => console.error('Error:', error));


      })
    });
  });

  closeUpdateModal.addEventListener("click", function() {
    modal.style.display = "none";
    console.log("Modal closed.");
  });

  updateButton.addEventListener("click", function() {
    console.log("Update button clicked.");
    // Add your update logic here
    modal.style.display = "none";
  });


  window.addEventListener("click", function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
      console.log("Modal closed by clicking outside.");
    }
  });
})


// End Edit Category [[[[[[[[[[]]]]]]]]]]


//####### ADDDD CATEGORY

    document.getElementById('form-category').addEventListener('submit',(e)=>{
     console.log('add Category')
     e.preventDefault()
     const title = document.getElementById('title').value.trim();
     const discription = document.getElementById('discr').value.trim();


     if (!title.match(/^[A-Za-z ]+$/) || !discription.match(/^[A-Za-z ]+$/)) {
   
       showToast("Name  and Discriotion should contain only letters and spaces.",'info') 
    
    return;
  }
     const formData=new FormData()
     formData.append('title',document.getElementById('title').value.trim())
     formData.append('discription',document.getElementById('discr').value.trim())
    
     formData.append('image',document.getElementById('image').files[0])
  


     
     
     
         try {
         fetch('/admin/addCategory',{
          method:'post',
          body:formData
         }).then(res=>res.json())
         .then(data=>{
         
          if(data.success){
            alert(data.message)
            console.log(data)
            showToast(data.message, 'success');
               
            }else{
              alert(data.message)
              console.log(data)
              showToast(data.message, 'error');
            }
            })
      
         } catch (error) {
         console.log(error.message);
         
         }
  
    })
    function updateHtml(item){
      console.log("iijjjj",item);
      
      let element=`
                    <div class="category-header">
                      <div class="category-name">
                        <img src="http://localhost:4000/images/${item.image}" style="width: 60px;height: 60px;" alt="Category Image" class="category-image">
                        <span>${item.category} </span>
                      </div>
                      <p> ${item.description} </p>
                      <div>
                        <h5 style="color: green;">${item.Offer}</h5>
                       ${item.Offer ?`  
                          <button style="border-radius: 8px; border: none; color: gray; padding: 5px; background-color: rgb(214, 214, 214);" id="clearOfferBtn" onclick="clearOfferPrice('${item.category}')">Clear Offer</button>
                        `:`""`}
                       
                      </div>
                      <div class="category-actions">
                        <button class="btn btn-edit" id="openEditModal">Edit</button>
                      ${item.isList===true?

                        `<button class="btn btn-outline-success" onclick="toggleItemStatus('${item._id}',true)">List</button>`
                       :
                       ` <button class="btn btn-outline-danger" onclick="toggleItemStatus('${item._id}',false)">Unlist</button>`
                      }
                        <svg class="arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                      </div>
                    </div>
                    
                  `


      let modify = document.getElementById(`divTAbl${item._id}`)
      modify.innerHTML=element
    }

    // Add category  {{{{{{{{{{{{{{{}}}}}}}}}}}}}}} 
      </script>
 <!-- card .// -->
      </section>
      <!-- content-main end// -->
  
    </main>
    <script src="/showNotification.js"></script>
    <script src="/admin/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/admin/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/admin/js/vendors/select2.min.js"></script>
    <script src="/admin/js/vendors/perfect-scrollbar.js"></script>
    <script src="/admin/js/vendors/jquery.fullscreen.min.js"></script>
    <!-- Main Script -->
    <script src="/admin/js/main.js?v=1.1" type="text/javascript"></script>
  </body>
</html>

