<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Nest Dashboard</title>
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta property="og:title" content="" />
        <meta property="og:type" content="" />
        <meta property="og:url" content="" />
        <meta property="og:image" content="" />
        <!-- Favicon -->
        <link rel="shortcut icon" type="image/x-icon" href="/admin/imgs/theme/favicon.svg" />
        <!-- Template CSS -->
        <link href="/admin/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
        <style>
            .pending {
  color: orange;
 /* color: lightyellow; */
}

.shipped {
  color: blue;
  /* color: lightblue; */
}

.on-delivery {
  color: green;
  /* color: lightgreen; */
}

.delivered {
  color: darkgreen;
  /* color: lightseagreen; */
}

.cancelled {
  /* color: white; */
 color: red;
}

.return {
  color: darkorange;
  /* background-color: lightcoral; */
}
        </style>
    </head>

    <body>
        
        <%-include('../partials/sidebar.ejs') %>
      <%-include('../partials/block.ejs')%>
      
        <main class="main-wrap">
            <%-include('../partials/adminHeader')%>
           
            <section class="content-main">
                <div class="content-header">
                    <div>
                        <h2 class="content-title card-title">Order detail</h2>
                        <!-- <p>Details for Order ID: 345</p> -->
                    </div>
                </div>
                <div class="card">
                    <header class="card-header">
                        <div class="row align-items-center">
                            <div class="col-lg-6 col-md-6 mb-lg-0 mb-15">
                                <span> <i class="material-icons md-calendar_today"></i> <b> <%= new Date(orders.createdAt).toLocaleString('en-US', {
                                    weekday: 'short', 
                                    month: 'short',    
                                    day: '2-digit',    
                                    year: 'numeric',   
                                    hour: 'numeric',   
                                    minute: '2-digit', 
                                    hour12: true      
                                  }) %></b> </span> <br />
                                <small style="color: rgb(36, 36, 36); font-size: 18px   ;">Order ID: <%=orders.id%></small>
                            </div>
                            <div class="col-lg-6 col-md-6 ms-auto text-md-end">
                                <form action="" id="status-form">
                                <select class="form-select d-inline-block mb-lg-0 mr-5 mw-200" id="status">
                                    <option>Change status</option>
                                    
                                    <option value="Comfirmed">Comfirmed</option>
                                    <option value="Placed">Placed</option>
                                    <option value="Shipped">Shipped</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="'cancelled'">cancelled</option>
                                    <option value="Return">Return</option>
                                    <option value="On Delivery">On Delivery</option>
                                </select>
                                <input type="text" name="" id="OrdeID" value="<%=orders.id%>" hidden>
                                <button type="submit" class="btn btn-primary" href="#">Save</button>
                                <!-- <a class="btn btn-secondary print ms-2" href="#"><i class="icon material-icons md-print"></i></a> -->
                            </form>
                            </div>
                        </div>
                    </header>
                    <!-- card-header end// -->
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <article class="icontext align-items-start">
                                    <span class="icon icon-sm rounded-circle bg-primary-light">
                                        <i class="text-primary material-icons md-person"></i>
                                    </span>
                                    <div class="text">
                                        <h6 class="mb-1">Customer</h6>
                                        <p class="mb-1">
                                            <%=orders.UserID.firstName%>.<br />
                                            <%=orders.UserID.email%><br />
                                            <%=orders.UserID.phone%>
                                        </p>
                                        
                                    </div>
                                </article>
                            </div>
                            <!-- col// -->
                            <div class="col-md-4">
                                
                            </div>
                            <!-- col// -->
                            <div class="col-md-4">
                                <article class="icontext align-items-start">
                                    <span class="icon icon-sm rounded-circle bg-primary-light">
                                        <i class="text-primary material-icons md-place"></i>
                                    </span>
                                    <div class="text">
                                        <h6 class="mb-1">Deliver to</h6>
                                        <p class="mb-1">
                                            City: <%=orders.addressId.District%>, <%=orders.addressId.State%> <br />PIN :<%=orders.addressId.PIN%>, <%=orders.addressId.place%>,<%=orders.addressId.mark%> <br />
                                           
                                        </p>
                                       
                                    </div>
                                </article>
                            </div>
                            <!-- col// -->
                        </div>
                        <!-- row // -->
                        <div class="">
                            
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th width="20%">Product</th>
                                                
                                                <th width="20%">Unit Price</th>
                                                <th width="20%">Status</th>
                                                <th  width="20%">Status Ctrl</th>
                                                <th width="20%">Quantity</th>
                                                <th width="20%" class="text-end">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <%orders.Products.forEach(item=>{%>
                                            <tr>
                                                <td>
                                                    <a class="itemside" href="#">
                                                        <div class="left">
                                                            <img src="http://localhost:4000/images/<%= item.product.primaryImage %>" width="40" height="40" class="img-xs" alt="Item" />
                                                        </div>
                                                        <div class="info"><%=item.Name%></div>
                                                    </a>
                                                </td>
                                                <td>
                                                    <div>
                                                        <% if (item.product.OfferPrice) { %>
                                                          <div >
                                                          
                                                           <span><h4 style="color: green; margin: 5px 0; font-size: 14px;">Offer: <%= item.product.OfferPrice %> ₹</h4></span>
                                                           <p style="color: gray; margin: 5px 0; font-size: 12px;">
                                                              <span style="color: red;">Per Kg</span>
                                                              <del style="color: red;"><%= item.product.RegulerPrice %></del>₹
                                                            </p>
                                                          </div>
                                                            
                                                        <% } else { %>
                                                          <p style="margin: 5px 0; font-size: 14px;">Per Kg <span style="font-weight: bold;"><%= item.product.RegulerPrice %></span>₹</p>
                                                        <% } %>
                                                        <div>
                                                </td>
                                                <td class="<%= 
                                            item.status === 'Pending' ? 'pending' : 
                                            item.status === 'Shipped' ? 'shipped' : 
                                            item.status === 'On Delivery' ? 'on-delivery' : 
                                            item.status === 'Delivered' ? 'delivered' : 
                                            item.status === 'Cancelled' ? 'cancelled' : 
                                            item.status === 'Return' ? 'return' : '' 
                                            %>">
                                            <%= item.status %>
                                            <td></td>
                                            </td>

                                  
                                                <td><%=item.quantity%></td>
                                                <td class="text-end">₹<%=item.TOTAL%></td>
                                            </tr>
                                            <%})%>
                                            
                                        </tbody>
                                    </table>
                                                <hr>
                                                    <article class="float-end">
                                                        <dl class="dlist">
                                                            <dt>Subtotal:</dt>
                                                            <dd>₹<%=orders.subTotal%></dd>
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt>Shipping cost:</dt>
                                                            <dd>₹<%=orders.Shipping%></dd>
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt>Discount :</dt>
                                                            <dd>₹<%=orders.Coupon.discountValue%></dd>
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt>Grand total:</dt>
                                                            <dd><b class="h5">₹<%=orders.Final_Amount%></b></dd>
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt class="text-muted">Status:</dt>
                                                            <dd>
                                                                <span class="badge rounded-pill alert-success text-success"><%=orders.paymentStatus%></span>
                                                            </dd>
                                                        </dl>
                                                    </article>
                                              
                                                    <div class="col-lg-4">
                                                        <div class="box shadow-sm bg-light">
                                                            <h6 class="mb-15">Payment info</h6>
                                                            <!-- <p>
                                                                <img src="/admin/imgs/card-brands/2.png" class="border" height="20" /> Master Card **** **** 4768 <br />
                                                                Business name: Grand Market LLC <br />
                                                                Phone: +1 (800) 555-154-52
                                                            </p> -->
                                                            <%=orders.payment%>
                                                        </div>
                                                       
                                                    </div>
                                      
                                </div>
                                <!-- table-responsive// -->
                           
                            <!-- col// -->
                           
                            
                            <!-- col// -->
                        </div>
                    </div>
                    <!-- card-body end// -->
                </div>
                <!-- card end// -->
            </section>
            <!-- content-main end// -->
          
        </main>
        <script src="/admin/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="/admin/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="/admin/js/vendors/select2.min.js"></script>
        <script src="/admin/js/vendors/perfect-scrollbar.js"></script>
        <script src="/admin/js/vendors/jquery.fullscreen.min.js"></script>
        <!-- Main Script -->
        <script src="/admin/js/main.js?v=1.1" type="text/javascript"></script>

        <script>
            document.getElementById('status-form').addEventListener('submit',(e)=>{
                e.preventDefault()
                const Status=document.getElementById('status').value
                const OrdeID=document.getElementById('OrdeID').value
                console.log(status)

                fetch('/admin/OrderStatus',{
                    method:'PUT',
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({
                        Status,
                        OrdeID
                    })
                }).then(res=>res.json())
                .then(data=>{
                    alert(data.message)
                })

            })
        </script>
    </body>
</html>
